<?php

declare(strict_types=1);

namespace DoctrineMigrations;

use Doctrine\DBAL\Schema\Schema;
use Doctrine\Migrations\AbstractMigration;

/**
 * Auto-generated Migration: Please modify to your needs!
 */
final class Version20260106155619 extends AbstractMigration
{
    public function getDescription(): string
    {
        return '';
    }

    public function up(Schema $schema): void
    {
        // this up() migration is auto-generated, please modify it to your needs
        $this->addSql('CREATE TABLE properties (id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL, reference VARCHAR(50) NOT NULL, title VARCHAR(255) NOT NULL, description TEXT NOT NULL, property_type VARCHAR(255) NOT NULL, transaction_type VARCHAR(255) NOT NULL, rooms INT DEFAULT NULL, bedrooms INT DEFAULT NULL, bathrooms INT DEFAULT NULL, toilets INT DEFAULT NULL, floor INT DEFAULT NULL, total_floors INT DEFAULT NULL, living_area NUMERIC(10, 2) DEFAULT NULL, land_area NUMERIC(10, 2) DEFAULT NULL, construction_year INT DEFAULT NULL, has_elevator BOOLEAN DEFAULT false NOT NULL, has_parking BOOLEAN DEFAULT false NOT NULL, has_terrace BOOLEAN DEFAULT false NOT NULL, has_balcony BOOLEAN DEFAULT false NOT NULL, has_garden BOOLEAN DEFAULT false NOT NULL, has_pool BOOLEAN DEFAULT false NOT NULL, has_cellar BOOLEAN DEFAULT false NOT NULL, has_air_conditioning BOOLEAN DEFAULT false NOT NULL, has_heating BOOLEAN DEFAULT false NOT NULL, energy_class VARCHAR(255) DEFAULT NULL, ges_class VARCHAR(255) DEFAULT NULL, price NUMERIC(12, 2) NOT NULL, price_per_sqm NUMERIC(10, 2) DEFAULT NULL, fees_included BOOLEAN DEFAULT false NOT NULL, charges_monthly NUMERIC(8, 2) DEFAULT NULL, property_tax_yearly NUMERIC(8, 2) DEFAULT NULL, address TEXT NOT NULL, city VARCHAR(100) NOT NULL, postal_code VARCHAR(10) NOT NULL, department VARCHAR(50) DEFAULT NULL, region VARCHAR(50) DEFAULT NULL, country VARCHAR(100) DEFAULT \'France\' NOT NULL, latitude NUMERIC(10, 8) DEFAULT NULL, longitude NUMERIC(11, 8) DEFAULT NULL, status VARCHAR(255) NOT NULL, is_featured BOOLEAN DEFAULT false NOT NULL, is_urgent BOOLEAN DEFAULT false NOT NULL, is_highlighted BOOLEAN DEFAULT false NOT NULL, view_count INT DEFAULT 0 NOT NULL, contact_count INT DEFAULT 0 NOT NULL, published_at TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT NULL, expires_at TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT NULL, created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, updated_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, agency_id INT NOT NULL, agent_id INT NOT NULL, PRIMARY KEY (id))');
        $this->addSql('CREATE UNIQUE INDEX UNIQ_87C331C7AEA34913 ON properties (reference)');
        $this->addSql('CREATE INDEX IDX_87C331C7CDEADB2A ON properties (agency_id)');
        $this->addSql('CREATE INDEX IDX_87C331C73414710B ON properties (agent_id)');
        $this->addSql('CREATE TABLE property_history (id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL, action_type VARCHAR(50) NOT NULL, changes JSON DEFAULT NULL, created_at TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, property_id INT NOT NULL, user_id INT DEFAULT NULL, PRIMARY KEY (id))');
        $this->addSql('CREATE INDEX IDX_7E773A33549213EC ON property_history (property_id)');
        $this->addSql('CREATE INDEX IDX_7E773A33A76ED395 ON property_history (user_id)');
        $this->addSql('ALTER TABLE properties ADD CONSTRAINT FK_87C331C7CDEADB2A FOREIGN KEY (agency_id) REFERENCES agencies (id) ON DELETE CASCADE NOT DEFERRABLE');
        $this->addSql('ALTER TABLE properties ADD CONSTRAINT FK_87C331C73414710B FOREIGN KEY (agent_id) REFERENCES "user" (id) NOT DEFERRABLE');
        $this->addSql('ALTER TABLE property_history ADD CONSTRAINT FK_7E773A33549213EC FOREIGN KEY (property_id) REFERENCES properties (id) ON DELETE CASCADE NOT DEFERRABLE');
        $this->addSql('ALTER TABLE property_history ADD CONSTRAINT FK_7E773A33A76ED395 FOREIGN KEY (user_id) REFERENCES "user" (id) NOT DEFERRABLE');
    }

    public function down(Schema $schema): void
    {
        // this down() migration is auto-generated, please modify it to your needs
        $this->addSql('ALTER TABLE properties DROP CONSTRAINT FK_87C331C7CDEADB2A');
        $this->addSql('ALTER TABLE properties DROP CONSTRAINT FK_87C331C73414710B');
        $this->addSql('ALTER TABLE property_history DROP CONSTRAINT FK_7E773A33549213EC');
        $this->addSql('ALTER TABLE property_history DROP CONSTRAINT FK_7E773A33A76ED395');
        $this->addSql('DROP TABLE properties');
        $this->addSql('DROP TABLE property_history');
    }
}
